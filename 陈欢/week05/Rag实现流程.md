# RAG功能实现文档

## 功能模块

### 项目超参数配置

- 数据库参数配置

	- SQLite/MySQL连接信息

- 大模型配置

	- 嵌入模型配置
	- 重排序模型配置
	- LLM配置

- Rag超参数配置

	- 分块大小、重叠度、检索候选数等

### RAG

- 文档处理

	- PDF文档解析，文本提取，分块处理，向量生成

- 知识库构建

	- 将文档内容、向量存储到ElasticSearch中

- 检索

	- 使用BM25算法进行全文检索
	- 基于向量相似度，进行语义检索
	- 融合全文检索和语义检索的检索结果
	- 重排序：重新排序检索结果

- RAG对话

	- 根据检索到的相关文档，构造提示词，调用LLM生成回答

### FastAPI部署

- 定义接口的请求和响应的数据结构
- RAG功能调用接口
- 知识库管理接口

	- 根据知识库的ID进行增删改查

- 数据库文档管理接口

	- 根据文档ID进行增删改查

## 功能流程

### 读取配置文件

- 通过config.yaml加载系统参数

### 初始化核心组件

- 通过SQLAlchemy创建数据库引擎，定义KnowledgeDatabase 和 KnowledgeDocument 表结构
- 初始化ES客户端

### 知识库和文档的管理

- 创建知识库
- 对知识库和文档进行增删改查

### 文档内容提取和分块

- PDF等文档格式处理
- 文本分块
- 向量化

	- 对分块好的内容分别向量化，并存储起来

### 检索增强生成

- 使用BM25进行全文检索
- 使用KNN进行向量检索
- 使用RRF合并检索结果
- 重排序
- Prompt

	- 将检索到的内容进行拼接，生成最终的Prompt

- LLM调用

	- 使用open AI调用指定模型，或者调用本地预训练模型，传入Prompt生成回答

