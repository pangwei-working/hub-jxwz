# 作业一：外卖二分类微调

1. 作业描述：单独给一个外卖评价数据集，需要大家使用bert模型做微调，使用fastapi部署为服务。
2. 作业完成过程：
	- 基于课堂脚本9和脚本10进行数据集适配修改。
		- 脚本9：主要修改文件加载、数据划分等数据处理阶段。
		- 脚本10：主要修改数据加载、模型参数传入、评估指标增加（f1）及最佳模型保存
	- 推理脚本的撰写，调用保存的最佳F1模型进行单批次推理
	- 适配之前的intent-classify项目，添加接口`@app.post("/v1/text-cls-takeout/bert")`
	- 尝试打包成docker，但是因为本机的空间不足，没能打包成功，之前的intent-classify已打包成docker，但由于包含torch包以及bert的几个模型导致文件过大，container高达13.19GB
3. 上传文件说明
	- 作业-10_BERT外卖评价分类.py：课上代码修改为作业部分
	- 作业_09_BERT外卖评价分类.py：课上代码修改为作业部分
	- 作业-外卖评价分类推理.py：添加模型推理部分
	- main.py：intent-classify项目文件适配新接口的更新
	- model/bert.py：intent-classify项目文件适配新任务的更新
# 作业二：ab测试分类服务
1.  作业描述：部署完服务后，使用ab测试一下，1/5/10 并发下总耗时；
2. 作业完成过程：
	- 启动更新后的fastapi项目并使用ab测试当前的五种接口（request均为100，用户量根据设置依次测试），具体结果如下所示。
	- 接口格式与最初的接口格式保持一致
	- 大模型调用的是本地ollama部署的deepseek-r1的1.5b模型
## `/v1/text-cls-takeout/bert`接口
### 1并发
```cmd
Connection Times (ms)
              min  mean[+/-sd] median   max
Connect:        0    0   0.5      0       2
Processing:     6   10   9.8      7      57
Waiting:        5    9   9.8      7      55
Total:          6   10   9.9      7      57

Percentage of the requests served within a certain time (ms)
  50%      7
  66%      8
  75%      9
  80%      9
  90%     10
  95%     36
  98%     56
  99%     57
 100%     57 (longest request)

```
### 10并发
```cmd
Connection Times (ms)
              min  mean[+/-sd] median   max
Connect:        0    0   0.4      0       2
Processing:    32   75  38.9     64     224
Waiting:       32   75  38.7     63     223
Total:         32   75  38.8     64     224

Percentage of the requests served within a certain time (ms)
  50%     64
  66%     66
  75%     67
  80%     68
  90%    175
  95%    179
  98%    214
  99%    224
 100%    224 (longest request)
```
### 50并发
```cmd
Connection Times (ms)
              min  mean[+/-sd] median   max
Connect:        0    0   0.4      0       2
Processing:    65  395 138.6    421     728
Waiting:       58  390 137.5    417     724
Total:         66  395 138.5    421     728

Percentage of the requests served within a certain time (ms)
  50%    421
  66%    461
  75%    467
  80%    478
  90%    523
  95%    699
  98%    723
  99%    728
 100%    728 (longest request)
```
### 100并发
```cmd
Connection Times (ms)
              min  mean[+/-sd] median   max
Connect:        0    0   0.3      0       2
Processing:    76  711  70.5    720     757
Waiting:       64  705  71.4    712     757
Total:         76  711  70.5    720     757

Percentage of the requests served within a certain time (ms)
  50%    720
  66%    737
  75%    746
  80%    746
  90%    752
  95%    753
  98%    757
  99%    757
 100%    757 (longest request)

```
### `/v1/text-cls/bert`接口
### 1并发
```cmd
Connection Times (ms)
              min  mean[+/-sd] median   max
Connect:        0    0   0.3      0       1
Processing:     5   10  13.7      7     111
Waiting:        5   10  13.7      7     111
Total:          5   10  13.8      7     112

Percentage of the requests served within a certain time (ms)
  50%      7
  66%      7
  75%      8
  80%      8
  90%      9
  95%     51
  98%     55
  99%    112
 100%    112 (longest request)
```
### 10并发
```cmd
Connection Times (ms)
              min  mean[+/-sd] median   max
Connect:        0    0   0.4      0       2
Processing:    35   85  60.3     67     270
Waiting:       35   84  60.2     66     268
Total:         35   85  60.2     67     270

Percentage of the requests served within a certain time (ms)
  50%     67
  66%     69
  75%     71
  80%     72
  90%    257
  95%    265
  98%    269
  99%    270
 100%    270 (longest request)

```
### 50并发
```cmd
Connection Times (ms)
              min  mean[+/-sd] median   max
Connect:        0    0   0.4      0       2
Processing:    65  410 159.5    421     673
Waiting:       54  406 156.9    418     668
Total:         66  411 159.5    421     673

Percentage of the requests served within a certain time (ms)
  50%    421
  66%    555
  75%    581
  80%    596
  90%    624
  95%    654
  98%    659
  99%    673
 100%    673 (longest request)
```
### 100并发
```cmd
Connection Times (ms)
              min  mean[+/-sd] median   max
Connect:        0    0   0.2      0       1
Processing:    65  636  65.2    639     691
Waiting:       54  631  66.0    634     690
Total:         65  636  65.2    639     691

Percentage of the requests served within a certain time (ms)
  50%    639
  66%    657
  75%    667
  80%    669
  90%    686
  95%    689
  98%    690
  99%    691
 100%    691 (longest request)

```
## `/v1/text-cls/gpt`接口

### 50并发
```cmd
Connection Times (ms)
              min  mean[+/-sd] median   max
Connect:        0    0   0.4      0       2
Processing:   874 9781 3356.4  11223   15271
Waiting:      860 9781 3356.8  11222   15268
Total:        876 9781 3356.4  11223   15272

Percentage of the requests served within a certain time (ms)
  50%  11223
  66%  12112
  75%  12235
  80%  12237
  90%  12356
  95%  13230
  98%  15269
  99%  15272
 100%  15272 (longest request)
```
### 100并发
```cmd
Connection Times (ms)
              min  mean[+/-sd] median   max
Connect:        0    0   0.4      0       2
Processing:  6761 17228 3264.7  15281   25037
Waiting:     6740 17227 3265.3  15281   25037
Total:       6761 17228 3264.7  15281   25037

Percentage of the requests served within a certain time (ms)
  50%  15281
  66%  17093
  75%  19216
  80%  20200
  90%  23015
  95%  24211
  98%  24934
  99%  25037
 100%  25037 (longest request)
```

## `/v1/text-cls/tfidf`接口

### 100并发
```cmd
Connection Times (ms)
              min  mean[+/-sd] median   max
Connect:        0    0   0.3      0       1
Processing:    24   95  41.4     96     481
Waiting:       14   92  41.4     94     471
Total:         24   95  41.4     96     481

Percentage of the requests served within a certain time (ms)
  50%     96
  66%     99
  75%     99
  80%     99
  90%    100
  95%    101
  98%    101
  99%    481
 100%    481 (longest request)
```
## `/v1/text-cls/regex`接口

### 100并发
```cmd
Connection Times (ms)
              min  mean[+/-sd] median   max
Connect:        0    0   0.3      0       1
Processing:    20   51   6.9     53      61
Waiting:        4   48   8.3     50      58
Total:         20   51   6.9     53      62

Percentage of the requests served within a certain time (ms)
  50%     53
  66%     54
  75%     55
  80%     56
  90%     58
  95%     59
  98%     61
  99%     62
 100%     62 (longest request)
```



